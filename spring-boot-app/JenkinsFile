pipeline {
  options { timestamps(); timeout(time: 10, unit: 'MINUTES') }
  agent {
    docker {
      image 'maven:3.9-eclipse-temurin-17'   // use a known-good image first
      args '-v /var/run/docker.sock:/var/run/docker.sock'
      // alwaysPull true
    }
  }
  stages {
    stage('Agent sanity') {
      steps {
        sh 'whoami; id || true'
        sh 'docker info >/dev/null 2>&1 && echo "Docker OK" || (echo "Docker NOT OK"; exit 1)'
        sh 'git --version || (echo "git missing"; exit 1)'
        sh 'mvn -v || (echo "maven missing"; exit 1)'
      }
    }
    stage('Try your image') {
      steps {
        sh 'echo "Pulling your imageâ€¦"; docker pull abhishekf5/maven-abhishek-docker-agent:v1'
      }
    }
  }
}
